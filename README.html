<h1 id="parcours-s06-fire">Parcours S06 üî•</h1>
<p>Une √©cole 100% en ligne formant des d√©veloppeurs Web souhaite mettre en place un BackOffice de gestion de leurs formateurs et de leurs √©tudiants.</p>
<blockquote>
  <p>ceci est une ≈ìuvre de fiction. Toute ressemblance avec des personnages ayant r√©ellement exist√© serait purement fortuite</p>
</blockquote>
<h2 id="informations-information_source">Informations ‚ÑπÔ∏è</h2>
<p><strong>üí° Conseil du jour, bonjour</strong>  <br />
Prend bien le temps de lire TOUT l'√©nonc√© avant de commencer √† coder.  <br />
De nombreux √©l√©ments sont fournis, pour gagner du temps. Ce serait dommage de passer √† c√¥t√© üòâ</p>
<h3 id="1-routes-_controllers_-motorway">#1 Routes, <em>Controllers</em> üõ£</h3>
<ul>
<li>la liste des routes du projet est fournie : <a href="docs/routes.md">docs/routes.md</a></li>
<li>toutes les routes ne sont pas √† mettre en place</li>
<li>il est pr√©f√©rable d'ajouter chaque route au fur et √† mesure du besoin</li>
<li>les noms de <em>Controllers</em> sont libres</li>
<li>les noms des m√©thodes de ces <em>Controllers</em> sont libres aussi</li>
</ul>
<h3 id="2-int√©gration-htmlcss-lipstick">#2 Int√©gration HTML/CSS üíÑ</h3>
<ul>
<li>l'int√©gration HTML du projet est fournie dans <a href="docs/integration-html-css/">docs/integration-html-css/</a></li>
<li>toutes les pages de cette int√©gration ne sont pas √† mettre en place</li>
<li>√† chaque nouvelle page/route, tu peux piocher le code HTML n√©cessaire</li>
</ul>
<h3 id="3-imports-sql-floppy_disk">#3 Imports SQL üíæ</h3>
<ul>
<li>‚ö†Ô∏è il y a 2 fichiers d'imports SQL :</li>
<li>import des tables et champs : <a href="docs/structure.sql">docs/structure.sql</a></li>
<li>import des donn√©es : <a href="docs/data.sql">docs/data.sql</a></li>
<li>il faut bien entendu effectuer les imports dans le bon ordre :</li>
<li>importer d'abord la structure</li>
<li>puis se placer dans la base de donn√©es <code>skoule</code> cr√©√©e</li>
<li>et enfin importer les donn√©es</li>
</ul>
<h3 id="4-architecture-mvc-heart_eyes">#4 Architecture MVC üòç</h3>
<ul>
<li>on ne va pas r√©inventer la roue compl√®te lors de ce parcours</li>
<li>on va plut√¥t se baser sur le code de cette saison (BackOffice), et le personnaliser</li>
<li>on peut r√©cup√©rer le code complet de <em>oShop</em> et supprimer le code superflu</li>
<li>ou bien partir de z√©ro et copier-coller des bouts de code de <em>oShop</em> n√©cessaires</li>
<li>par contre, il ne doit pas rester le moindre code sp√©cifique au projet <em>oShop</em>, il faudra donc bien penser √† supprimer les bouts de code inutiles</li>
</ul>
<h3 id="5-git">#5 Git</h3>
<ul>
<li>la correction de ce parcours se fera gr√¢ce √† une <em>Pull Request</em></li>
<li><a href="https://kourou.oclock.io/ressources/fiche-recap/pull-request/">fiche r√©cap sur la cr√©ation d'une <em>Pull Request</em></a> √† faire √† la fin du parcours</li>
<li>sauf que pour faire une <em>Pull Request</em>, il faut d√©j√† penser √† coder dans une nouvelle branche ü§î</li>
</ul>
<h2 id="lets-code--keyboard">Let's code ! ‚å®Ô∏è</h2>
<h3 id="1-cr√©er-une-nouvelle-branche">#1 Cr√©er une nouvelle branche</h3>
<ul>
<li>pour pr√©parer la PR</li>
<li>cr√©er une nouvelle branche (nomm√©e <code>skoule</code> ou <code>parcours</code> par exemple)</li>
<li>comme je me suis lev√© du bon pied ce matin, je veux bien donner la commande</li>
<li><code>git checkout -b nom-de-la-branche</code></li>
<li>c'est üéÅ, ne me remerciez pas üòÖ</li>
</ul>
<h3 id="2-lister-tous-les-profs">#2 Lister tous les profs</h3>
<ul>
<li>coder route, <em>Controller</em>, <em>View</em>, <em>Model</em></li>
<li>pour t'aider, on te fournit les bouts de code ci-dessous</li>
</ul>
<p><details><summary>r√©cup√©ration de tous les profs</summary></p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// On commence par r√©cup√©rer tous les Models Teachers</span>
<span class="hljs-comment">// pour transmettre ensuite √† la view</span>
<span class="hljs-variable">$teachersList</span> = <span class="hljs-title class_">Teacher</span>::<span class="hljs-title function_ invoke__">findAll</span>();
</code></pre>
<p></details></p>
<p><details><summary>Dans la vue, on affiche la liste de profs</summary></p>
<pre><code class="hljs html language-html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;table table-hover mt-4&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>Pr√©nom<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>Nom<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span>Titre<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;col&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
        <span class="hljs-meta">&lt;?php foreach ($teachersList as $currentTeacher) : ?&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;row&quot;</span>&gt;</span>&lt;?= $currentTeacher-&gt;getId() ?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;?= $currentTeacher-&gt;getFirstname() ?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;?= $currentTeacher-&gt;getLastname() ?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;?= $currentTeacher-&gt;getJob() ?&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;text-right&quot;</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;todo&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm btn-warning&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-pencil-square-o&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn-group&quot;</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;btn btn-sm btn-danger dropdown-toggle&quot;</span>
                        <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">&quot;dropdown&quot;</span> <span class="hljs-attr">aria-haspopup</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">aria-expanded</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;fa fa-trash-o&quot;</span> <span class="hljs-attr">aria-hidden</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dropdown-menu&quot;</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dropdown-item&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;todo&quot;</span>&gt;</span>Oui, je veux supprimer<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;dropdown-item&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;#&quot;</span> <span class="hljs-attr">data-toggle</span>=<span class="hljs-string">&quot;dropdown&quot;</span>&gt;</span>Oups !<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-meta">&lt;?php endforeach ?&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
</code></pre>
<p></details></p>
<h3 id="3-lister-tous-les-√©tudiants">#3 Lister tous les √©tudiants</h3>
<ul>
<li>coder route, <em>Controller</em>, <em>View</em>, <em>Model</em></li>
<li>pour t'aider, tu peux t'inspirer de l'√©tape pr√©c√©dente</li>
</ul>
<h3 id="4-ajout-dun-prof">#4 Ajout d'un prof</h3>
<ul>
<li>coder route, <em>Controller</em>, <em>View</em>, <em>Model</em></li>
<li>‚ö†Ô∏è il y a une route en <code>GET</code> et une autre en <code>POST</code></li>
<li>g√©n√©rer le lien du bouton "Ajouter" de la liste des profs, vers cette page d'ajout</li>
<li>une fois les donn√©es envoy√©es par le formulaire vers la m√™me URL mais en <code>POST</code></li>
<li>c'est la route en <code>POST</code> qui est sollicit√©e et ex√©cute la m√©thode de <em>Controller</em> correspondante</li>
<li>cette m√©thode contient tout le traitement n√©cessaire :</li>
<li>r√©cup√©rer les donn√©es</li>
<li>ajouter en DB</li>
<li>rediriger sur la page "liste"</li>
<li>(la validation simple des donn√©es sera un bonus)</li>
<li>pour t'aider, on te fournit les bouts de code ci-dessous</li>
</ul>
<p><details><summary>r√©cup√©ration des donn√©es en POST</summary></p>
<p><strong>Premi√®re fa√ßon : avec filter_input()</strong></p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// On r√©cup√®re les donn√©es</span>
<span class="hljs-variable">$firstname</span> = <span class="hljs-title function_ invoke__">filter_input</span>(INPUT_POST, <span class="hljs-string">&#x27;firstname&#x27;</span>);
<span class="hljs-variable">$lastname</span> = <span class="hljs-title function_ invoke__">filter_input</span>(INPUT_POST, <span class="hljs-string">&#x27;lastname&#x27;</span>);
<span class="hljs-variable">$job</span> = <span class="hljs-title function_ invoke__">filter_input</span>(INPUT_POST, <span class="hljs-string">&#x27;job&#x27;</span>);
<span class="hljs-variable">$status</span> = <span class="hljs-title function_ invoke__">filter_input</span>(INPUT_POST, <span class="hljs-string">&#x27;status&#x27;</span>, FILTER_VALIDATE_INT);
</code></pre>
<p><strong>Deuxi√®me fa√ßon : avec $_POST et les conditions ternaires</strong></p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// On r√©cup√®re les donn√©es</span>
<span class="hljs-variable">$firstname</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;firstname&#x27;</span>]) ? <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;firstname&#x27;</span>] : <span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-variable">$lastname</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;lastname&#x27;</span>]) ? <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;lastname&#x27;</span>] : <span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-variable">$job</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;job&#x27;</span>]) ? <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;job&#x27;</span>] : <span class="hljs-string">&#x27;&#x27;</span>;
<span class="hljs-variable">$status</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;status&#x27;</span>]) ? <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;status&#x27;</span>]) : <span class="hljs-number">0</span>;
</code></pre>
<p></details></p>
<p><details><summary>Ajout d'un prof en DB</summary></p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// On cr√©e un nouveau Model</span>
<span class="hljs-variable">$teacher</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Teacher</span>();

<span class="hljs-comment">// On renseigne les propri√©t√©s</span>
<span class="hljs-variable">$teacher</span>-&gt;<span class="hljs-title function_ invoke__">setFirstname</span>(<span class="hljs-variable">$firstname</span>);
<span class="hljs-variable">$teacher</span>-&gt;<span class="hljs-title function_ invoke__">setLastname</span>(<span class="hljs-variable">$lastname</span>);
<span class="hljs-variable">$teacher</span>-&gt;<span class="hljs-title function_ invoke__">setJob</span>(<span class="hljs-variable">$job</span>);
<span class="hljs-variable">$teacher</span>-&gt;<span class="hljs-title function_ invoke__">setStatus</span>(<span class="hljs-variable">$status</span>);

<span class="hljs-comment">// On sauvegarde en DB</span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$teacher</span>-&gt;<span class="hljs-title function_ invoke__">save</span>()) {
    <span class="hljs-comment">// TODO rediriger vers la page liste</span>
}
</code></pre>
<p></details></p>
<h3 id="5-ajout-dun-√©tudiant">#5 Ajout d'un √©tudiant</h3>
<ul>
<li>coder route, <em>Controller</em>, <em>View</em>, <em>Model</em></li>
<li>pour t'aider, tu peux t'inspirer de l'√©tape pr√©c√©dente</li>
<li>mais on te fournit aussi un bout de code üòâ</li>
</ul>
<p><details><summary>Ajout d'un √©tudiant en DB</summary></p>
<pre><code class="hljs php language-php"><span class="hljs-comment">// On cr√©e un nouveau Model</span>
<span class="hljs-variable">$student</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();

<span class="hljs-comment">// On renseigne les propri√©t√©s</span>
<span class="hljs-variable">$student</span>-&gt;<span class="hljs-title function_ invoke__">setFirstname</span>(<span class="hljs-variable">$firstname</span>);
<span class="hljs-variable">$student</span>-&gt;<span class="hljs-title function_ invoke__">setLastname</span>(<span class="hljs-variable">$lastname</span>);
<span class="hljs-variable">$student</span>-&gt;<span class="hljs-title function_ invoke__">setTeacherId</span>(<span class="hljs-variable">$teacherId</span>);
<span class="hljs-variable">$student</span>-&gt;<span class="hljs-title function_ invoke__">setStatus</span>(<span class="hljs-variable">$status</span>);

<span class="hljs-comment">// On sauvegarde en DB</span>
<span class="hljs-keyword">if</span> (<span class="hljs-variable">$student</span>-&gt;<span class="hljs-title function_ invoke__">save</span>()) {
    <span class="hljs-comment">// TODO rediriger vers la page liste</span>
}
</code></pre>
<p></details></p>
<h3 id="6-restreindre-lacc√®s-aux-utilisateurs">#6 Restreindre l'acc√®s aux utilisateurs</h3>
<ul>
<li>coder la page de connexion "sign in" (<code>GET</code> et <code>POST</code>)</li>
<li>coder le <em>Model</em> <code>AppUser</code></li>
<li>la table <code>app_user</code> contient actuellement 2 utilisateurs :</li>
<li><em>Lucie copin</em>, mot de passe : <code>cameleons</code></li>
<li><em>Adrien</em>, mot de passe : <code>nicole</code></li>
<li>d√©sormais, toutes les pages du projet n√©cessitent un utilisateur connect√©, SAUF :</li>
<li>la page de connexion, bien s√ªr üòâ</li>
</ul>
<h3 id="7-mettre-en-place-les-permissions">#7 Mettre en place les permissions</h3>
<ul>
<li>le <em>Role</em> de chaque utilisateur connect√© permet de d√©terminer √† quelles ressources/pages il a acc√®s</li>
<li>on a 2 <em>Roles</em> dans ce projet : <code>admin</code> et <code>user</code></li>
<li>les pages li√©es aux √©tudiants sont autoris√©es aux <em>Roles</em> <code>admin</code> et <code>user</code></li>
<li>les pages li√©es aux profs ont des permissions plus pr√©cises :</li>
<li>ajout, modification et suppression autoris√©s au <em>Role</em> <code>admin</code></li>
<li>liste autoris√©e aux <em>Roles</em> <code>admin</code> et <code>user</code></li>
</ul>
<h3 id="8-pull-request">#8 Pull Request</h3>
<ul>
<li>faire un <code>push</code> de son travail</li>
<li>aller sur son repo GitHub pour cr√©er la <em>Pull Request</em></li>
<li><a href="https://kourou.oclock.io/ressources/fiche-recap/pull-request/">fiche r√©cap sur la cr√©ation d'une <em>Pull Request</em></a></li>
</ul>
<h2 id="bonus">Bonus</h2>
<p>Et oui, comme pour les challenges, il y a <a href="bonus.md">des bonus</a> üéâ</p>